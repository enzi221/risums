_ENV.prelude = {}

local toon = require('toon.decode')

local function tableToString(t, indent)
  indent = indent or 0
  if type(t) ~= "table" then
    return tostring(t)
  end
  local str = "{"
  local first = true
  for k, v in pairs(t) do
    if not first then str = str .. ", " end
    first = false
    str = str .. "[" .. tostring(k) .. "]="
    if type(v) == "table" then
      str = str .. tableToString(v, indent + 1)
    else
      str = str .. tostring(v)
    end
  end
  return str .. "}"
end

local x = [[characters[5|]{name|age|gender|appearance|attire|job|personality|relationship|intent}:
  안나 그웬|28|여성|단정하게 땋은 차분한 녹색 머리, 따뜻한 갈색 눈, 건강하고 탄탄한 체격|깔끔한 저택 하녀복, 흰 앞치마|로제타의 전담 하녀 및 유모|성실함, 헌신적, 다정함, 신중함|유모 겸 전담 하녀|아가씨께서 생리 주기 때문에 고생이 많으시네... 무도회 때 불편하지 않도록 코르셋 보정부터 비상 대책까지 완벽하게 준비해 드려야지.
  루테온 하르겐|20|남성|햇빛에 빛나는 부드러운 갈색 머리, 맑은 금색 눈동자, 소년 같은 순한 인상|하얀색 바탕에 금색 태양 문양이 새겨진 신전 기사 제복, 금색 견장, 보석이 박힌 의례용 검|에오스 교단 성기사|순진함, 정직함, 우직함, 낯가림|면식 있는 기사|
  리칼 이시스 카드ion|22|남성|뒤로 넘긴 강렬한 붉은 머리, 날카롭고 매서운 적안, 크고 탄탄한 체격|활동적인 가죽 소재의 승마복, 흙이 묻은 가죽 부츠|카드ion 가문의 후계자, 소공작|오만함, 능력주의자, 독설가, 완벽주의자|이복 오빠|
  디안느 덴 에르테|19|여성|허리까지 내려오는 풍성한 은백색 머리카락, 투명하고 맑은 금안|우아하고 성스러운 순백의 신관복, 흰 장갑|에오스 교단의 성녀|영리함, 현실적, 외유내강, 대담함|지인|
  카드디온 공작|50|남성|위엄 있는 붉은 머리, 서늘하고 냉정한 적안, 건장한 체구|정갈하고 고급스러운 귀족 저녁 식사복|카드ion 가문의 가주, 공작|냉철함, 가부장적, 엄격함, 무관심|아버지|
histories:
  안나 그웬[3]:
    [0824-05-16 ~ 0824-05-24] 로제타의 전담 하녀로서 수도 뒷골목 약초상 방문을 보좌하고 마석 중독 해독제의 구입 및 복용 과정을 전담 관리함. 저택 내 소문과 정보를 수집해 전달하며 로제타의 안위를 살핌.
    [0824-05-24, 오후] 성녀 디안느의 방문과 소공작 리칼과의 충돌 사이에서 의복 준비와 접객을 지원함. 무도회 일정이 로제타의 생리 주기와 겹치는 것을 파악하고 건강 상태를 우려하며 특수 페티코트 제작 등 실질적인 대책을 마련함.
    [0824-05-24, 밤] 로제타에게 진통제 복용을 권유하고, 무도회 당일 신체적 불편함을 최소화하기 위한 코르셋 보정 및 비밀 보조 대책을 확답함.
  루테온 하르겐[2]:
    [0824-05-17] 카드ion 공작저 별관 갤러리에서 대기하던 중 로제타와 처음 조우함. 파도 그림에 대한 로제타의 냉소적이고 의연한 감상평을 듣고 그녀의 정신력을 높게 평가하며 존경심을 갖게 됨.
    [0824-05-24] 성녀 디안느의 호위 기사로 저택을 재방문하여 로제타와 재회함. 여전히 그녀를 인상 깊은 인물로 여기며 기사로서 정중한 예우를 갖춰 배웅함.
  리칼 이시스 카드ion[2]:
    [0824-05-16 ~ 0824-05-24] 연무장에서 로제타와 대치하며 그녀의 변화된 태도에 불쾌감과 의아함을 드러냄. 성녀 디안느의 방문 시 응접실에 난입하여 로제타의 파격적인 차림새와 성녀와의 관계를 비난하며 저녁 식사 참석을 강요함.
    [0824-05-24, 저녁] 저녁 식사 자리에서 로제타와 설전을 벌이며 황궁 무도회 참석이 가문의 의무임을 강조하고 무도회장에서의 품행 주의를 경고함.
  디안느 덴 에르테[1]:
    [0824-05-24, 오후] 카드ion 공작저를 방문하여 로제타와 독대함. 빈민가 마석 중독 아이의 회복 사건을 근거로 로제타의 행적을 추궁하면서도, 신전의 입장과 별개로 로제타의 변화를 흥미로워하며 비밀스러운 우호 관계를 제안함.
  카드디온 공작[1]:
    [0824-05-24, 저녁] 일주일 만에 열린 가족 식사 자리에서 로제타와 대면; 성녀와의 관계를 심문하고 황궁에서 열리는 개국 기념 무도회 참석을 공식적으로 명령함.]]

print(tableToString(toon.decode(x)))
